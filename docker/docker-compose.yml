version: '3'
services:
  roscore:
    privileged: true
    hostname: roscore
    build: ros
    environment:
      DISPLAY: $DISPLAY
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix
      - ./ros-files:/root/persistent-files
    command: xterm -fa Monospace -fs 10 -bg blue -fg white -e "roslaunch /root/persistent-files/core.launch"

  rosconsole:
    privileged: true
    hostname: rosconsole
    build: ros
    depends_on:
      - "roscore"
    environment:
      ROS_MASTER_URI: "http://roscore:11311"
      DISPLAY: ${DISPLAY}
      NVIDIA_VISIBLE_DEVICES: all
      NVIDIA_DRIVER_CAPABILITIES: all
      QT_X11_NO_MITSHM: 1
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix
      - ./ros-files:/root/persistent-files
    command: xterm -fa Monospace -fs 10 -bg black -fg green

  gmapping:
    privileged: true
    hostname: gmapping
    build: ros
    depends_on:
      - "roscore"
    environment:
      ROS_MASTER_URI: "http://roscore:11311"
      DISPLAY: ${DISPLAY}
      NVIDIA_VISIBLE_DEVICES: all
      NVIDIA_DRIVER_CAPABILITIES: all
      QT_X11_NO_MITSHM: 1
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix
    command: xterm -fa Monospace -fs 10 -bg brown -fg orange -e 'rosrun gmapping slam_gmapping scan:=scan _map_update_interval:=0.1 _maxUrange:=5.0 _kernel_size:=2 _delta:=0.05 output="screen"'

  rviz:
    privileged: true
    hostname: rviz
    build: ros
    depends_on:
      - "roscore"
    environment:
      ROS_MASTER_URI: "http://roscore:11311"
      DISPLAY: ${DISPLAY}
      NVIDIA_VISIBLE_DEVICES: all
      NVIDIA_DRIVER_CAPABILITIES: all
      QT_X11_NO_MITSHM: 1
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix
      - ./ros-files:/root/persistent-files
    command: xterm -fa Monospace -fs 10 -bg yellow -fg slateblue1 -e "rosrun rviz rviz -d /root/persistent-files/rviz-config.rviz"

  gazebo:
    privileged: true
    build: ros
    depends_on:
      - "roscore"
    environment:
      ROS_MASTER_URI: "http://roscore:11311"
      DISPLAY: ${DISPLAY}
      NVIDIA_VISIBLE_DEVICES: all
      NVIDIA_DRIVER_CAPABILITIES: all
      QT_X11_NO_MITSHM: 1
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix
      - ./gazebo-files/worlds:/root/worlds
      - ./gazebo-files/models:/root/.gazebo/models
      - ./gazebo-files/gui.ini:/root/.gazebo/gui.ini
    command: xterm -fa Monospace -fs 10 -bg black -fg slateblue1 -e "rosrun gazebo_ros gazebo --verbose /root/worlds/apartment/apartment.world"

networks:
  default:
    external:
      name: scanbot-network
